{"version":3,"sources":["../../../../../assets/Script/prefab/assets/Script/prefab/cube.js"],"names":["cc","Class","extends","Component","properties","state","default","Normal","type","cell","p","star","levelUpAnimation","Prefab","onLoad","node","on","Node","EventType","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_CANCEL","onTouchEnd","TOUCH_END","onLevelUp","onMoveUp","game","isTouched","row","moveTo","pAdd","position","height","gameManager","space","runAction","touchStartPos","Touched","TouchMove","levelUp","levelChange","starType","playLevelUpAnimation","playBombSound","init","setStarType","disablePhysics","start","setCellPos","setState","log","js","formatStr","JSON","stringify","Bombing","error","resetY","resetX","cubeMoved","FallingDown","activePhysics","FallingBottom","update","dt","removeCube","fitCell","checkFallingDown","y","touch","getLocation","parent","emit","dis","pDistance","pSub","newCell","posToPoint","column","checkBombing","cube1","cube2","onBeginContact","contact","selfCollider","otherCollider","body","RigidBodyType","Static","AddNewLine","cubeSelf","getComponent","cubeOther","rowPositions","toString","x","columnPositions","RigidBody","awake","Dynamic","Running","downCube","getCube","Block","sequence","callFunc","ani","instantiate","addChild"],"mappings":"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","file":"cube.js","sourceRoot":"../../../../../assets/Script/prefab","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n// import {CubeState} from './color-cube';\nimport {CubeState,StarTypes,GameState} from \"../consts\";\nimport Star from \"./star.js\";\n\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    state:{\n      default:CubeState.Normal,\n      type:CubeState\n    },\n    cell:cc.p(0,0),\n    star:{\n      default:null,\n      type:Star\n    },\n    levelUpAnimation:cc.Prefab\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n    this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this);\n    this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this);\n    // this.gameNode = cc.find(\"/Canvas/game-node\", cc.director.getRunningScene());\n    this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this);\n    this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this);\n\n    this.node.on(\"level-up\",this.onLevelUp,this);\n\n    this.node.on(\"move-up\",this.onMoveUp,this);\n\n    cc.game.on(\"add-new-line\",()=>{\n      if (!this.isTouched()||this.cell.row>0){\n        return;\n      }\n      let moveTo=cc.moveTo(0.2,cc.pAdd(this.node.position,cc.p(0,this.node.height+gameManager.space)));\n      this.node.runAction(moveTo);\n    });\n\n    this.touchStartPos=cc.p(0,0);\n  },\n\n  isTouched(){\n    return this.state===CubeState.Touched||this.state===CubeState.TouchMove;\n  },\n\n  // destroy(){\n  //   this.gameNode.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this);\n  // },\n\n  onLevelUp(){\n    this.star.levelUp();\n    gameManager.levelChange(this.star.starType);\n    // gameManager.playDeadAction(this.node.position);\n    this.playLevelUpAnimation();\n    gameManager.playBombSound();\n  },\n\n  init(cell,starType) {\n    this.cell=cell;\n    this.star.setStarType(starType);\n    this.disablePhysics();\n    // this.setState(CubeState.Block);\n  },\n\n  start() {\n\n  },\n\n  setCellPos(cell){\n    this.cell=cell;\n  },\n\n  setState(state) {\n    cc.log(cc.js.formatStr(\"set state,old:%d,new:%d,pos:%s\",this.state,state,JSON.stringify(this.cell)));\n    if (this.state===CubeState.Bombing){\n      cc.error(\"cube is marking dead\");\n      return;\n    }\n    if (this.state===state){\n      return;\n    }\n    switch (state){\n      case CubeState.Normal:{\n        this.disablePhysics();\n        this.resetY();\n        this.resetX();\n        gameManager.cubeMoved(this.node);\n        break;\n      }\n      case CubeState.TouchMove:{\n        break;\n      }\n      case CubeState.Touched:\n      case CubeState.FallingDown:{\n        this.activePhysics();\n        // this.resetX();\n      }\n      case CubeState.FallingBottom:{\n        break;\n      }\n    }\n    this.state=state;\n  },\n\n  update(dt) {\n    //添加新行时暂停下落\n    switch (this.state){\n      case CubeState.Bombing:{\n        gameManager.removeCube(this.node);\n        return;\n      }\n      case CubeState.TouchMove:{\n        this.fitCell();\n        break;\n      }\n      case CubeState.Normal:{\n        // this.disablePhysics();\n        this.checkFallingDown();\n        break;\n      }\n      case CubeState.FallingBottom:{\n        this.resetY();\n        this.setState(CubeState.Normal);\n        break;\n      }\n    }\n    //非touch状态时进行触底检查\n    if (this.state!==CubeState.Touched&&this.state!==CubeState.TouchMove){\n      if (this.node.y<this.node.height/2+gameManager.space){\n        this.setState(CubeState.FallingBottom);\n      }\n    }\n  },\n\n  onTouchStart(touch){\n    cc.log(\"on touch start\");\n    this.setState(CubeState.Touched);\n    // let body=this.node.getComponent(cc.RigidBody);\n    // body.awake=true;\n    // body.type=cc.RigidBodyType.Dynamic;\n\n    this.activePhysics();\n    this.touchStartPos=touch.getLocation();\n  },\n\n  onTouchEnd(touch){\n    cc.log(\"on touch end\");\n    this.node.parent.emit(cc.Node.EventType.TOUCH_END);   //告知touch关节触摸结束\n    if (this.state!==CubeState.Touched&&this.state!==CubeState.TouchMove){\n      return;\n    }\n    //重置mouse关节的冲量\n    this.disablePhysics();\n    this.setState(CubeState.FallingDown);\n    this.resetX();\n\n    this.touchStartPos=cc.p(0,0);\n  },\n\n  onTouchMove(touch){\n    cc.log(\"on touch moved\");\n    let dis=cc.pDistance(cc.pSub(touch.getLocation(),this.touchStartPos),cc.p(0,0));\n    if (dis>3){\n      if (this.state===CubeState.Touched){\n        this.setState(CubeState.TouchMove);\n        // gameManager.cubeMove(this.cell);\n\n      }\n    }\n  },\n\n  fitCell(){\n    let newCell=gameManager.posToPoint(this.node.position);\n    if (newCell.row!==this.cell.row||newCell.column!==this.cell.column){\n      gameManager.cubeMoved(this.node);\n\n    }\n  },\n\n  checkBombing(cube1,cube2){\n    if (cube1.star.starType!== cube2.star.starType) {\n      return false;\n    }\n\n    if (cube1.state === CubeState.Bombing) {\n      return false;\n    }\n\n    if (cube1.state===CubeState.TouchMove||cube1.state===CubeState.FallingDown){\n      return true;\n    }\n    return false;\n  },\n\n  //仅动态类型才处理碰撞\n  onBeginContact: function (contact, selfCollider, otherCollider) {\n    if (selfCollider.body.type===cc.RigidBodyType.Static||gameManager.state===GameState.AddNewLine){\n      return;\n    }\n\n    let cubeSelf=selfCollider.node.getComponent(\"cube\");\n    let cubeOther=otherCollider.getComponent(\"cube\");\n    if (!cubeSelf||!cubeOther){\n      return;\n    }\n\n    if (this.checkBombing(cubeSelf,cubeOther)){\n      cubeSelf.setState(CubeState.Bombing);\n      cubeOther.node.emit(\"level-up\");\n      return;\n    }\n\n    if (cubeSelf.state===CubeState.FallingDown){\n      cubeSelf.setState(CubeState.FallingBottom);\n    }\n  },\n\n  resetY(){\n    //更新cube的y坐标\n    cc.log(\"reset y called\");\n    let cell=gameManager.posToPoint(this.node.position);\n    this.node.y=gameManager.rowPositions[cell.row];\n    cc.log(\"reset y,new y:\"+this.node.y.toString());\n  },\n  resetX(){\n    //更新cube的x坐标\n    cc.log(\"reset x called\");\n    let cell=gameManager.posToPoint(this.node.position);\n    this.node.x=gameManager.columnPositions[cell.column];\n    cc.log(\"reset x,new x:\"+this.node.x.toString());\n  },\n\n  activePhysics(){\n    let body=this.node.getComponent(cc.RigidBody);\n    body.awake=true;\n    body.type=cc.RigidBodyType.Dynamic;\n  },\n\n  disablePhysics(){\n    let body=this.node.getComponent(cc.RigidBody);\n    if (body.type!==cc.RigidBodyType.Static){\n      body.type=cc.RigidBodyType.Static;\n    }\n  },\n\n  checkFallingDown(){\n    if (this.cell.row<=0||gameManager.state!==GameState.Running){\n      return;\n    }\n    let downCube=gameManager.getCube(this.cell.row-1,this.cell.column);\n    if (!downCube){\n      this.setState(CubeState.FallingDown);\n    }\n  },\n\n  onMoveUp(){\n    if (this.state===CubeState.Touched||this.state===CubeState.TouchMove){\n      return;\n    }\n    this.setState(CubeState.Block);\n    this.disablePhysics();\n    let moveTo=cc.moveTo(0.2,cc.pAdd(this.node.position,cc.p(0,this.node.height+gameManager.space)));\n    this.node.runAction(cc.sequence(moveTo,cc.callFunc(()=>{\n      this.setState(CubeState.Normal);\n    })));\n  },\n\n  playLevelUpAnimation(){\n    if (!this.levelUpAnimation){\n      return;\n    }\n    let ani=cc.instantiate(this.levelUpAnimation);\n    this.node.addChild(ani);\n  },\n});\n"]}