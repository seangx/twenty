{"version":3,"sources":["../../../../assets/Script/assets/Script/main.js"],"names":["cc","Class","extends","Component","properties","cubePrefab","Prefab","progressTime","ProgressBar","labelCurrentMax","Label","labelTopHistory","labelNewStar","starsForProgress","Node","subDomainEndPrefab","gamePauseNode","starDes","onLoad","log","director","getPhysicsManager","enabled","configManager","init","gameManager","node","getComponent","AudioSource","on","EventType","TOUCH_START","onTouchStart","initProgress","game","onMaxLevelChanged","onGameOver","createAd","onDestroy","off","children","i","length","child","x","setStarType","maxLevel","scale","dark","endLayer","instantiate","addChild","instance","displayFriendRankList","dataManager","userInfo","userId3","string","js","formatStr","getStarConfigByIndex","name","Animation","play","item","moveLeft","moveBy","p","runAction","sequence","callFunc","unDark","touch","hideStarDes","active","update","dt","progress","leftTime","newLineTime","toString","maxHistory","state","Pause","onRestartClicked","restart","onContinueClicked","setState","Running","onPauseClicked","onShareClicked","config","shareAppMessage"],"mappings":"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","file":"main.js","sourceRoot":"../../../../assets/Script","sourcesContent":["import Platform from \"./platform/platform\";\nimport {CubeState,CubeColors,GameState} from \"consts\";\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    cubePrefab: cc.Prefab,\n    progressTime:cc.ProgressBar,\n    labelCurrentMax:cc.Label,\n    labelTopHistory:cc.Label,\n    labelNewStar:cc.Label,\n\n    starsForProgress:[cc.Node],\n    subDomainEndPrefab:cc.Prefab,\n    gamePauseNode:cc.Node,\n    starDes:cc.Node,\n  },\n\n  // use this for initialization\n  onLoad: function () {\n    cc.log(\"enter main scene\");\n    cc.director.getPhysicsManager().enabled=true;\n    // cc.director.getPhysicsManager().debugDrawFlags=1;\n    // cc.view.enableAntiAlias(false);\n\n    configManager.init();\n    gameManager.init(this.cubePrefab,this.node,this.node.getComponent(cc.AudioSource));\n\n    // cc.game.addPersistRootNode(this.starDesNode);\n\n    this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this);\n    this.initProgress();\n    cc.game.on(\"max-level-changed\",this.onMaxLevelChanged,this);\n    cc.game.on(\"game-over\",this.onGameOver,this);\n\n    gameManager.createAd();\n  },\n  onDestroy(){\n    cc.game.off(\"max-level-changed\",this.onMaxLevelChanged,this);\n    cc.game.off(\"game-over\",this.onGameOver,this);\n  },\n\n  initProgress(){\n    let children=this.starsForProgress;\n    for (let i=0;i<children.length;i++){\n      let child=children[i];\n      if (i===0){\n        child.x=-1;\n        child.getComponent(\"star\").setStarType(gameManager.maxLevel);\n        child.scale=1.05\n      }else{\n        child.x=(109*(i));\n        child.getComponent(\"star\").setStarType(gameManager.maxLevel+(i));\n        child.getComponent(\"star\").dark();\n        child.scale=1;\n      }\n    }\n  },\n\n  onGameOver(){\n    let endLayer=cc.instantiate(this.subDomainEndPrefab);\n    this.node.addChild(endLayer);\n    Platform.instance.displayFriendRankList(dataManager.userInfo.userId3);\n  },\n\n  onMaxLevelChanged(){\n    // this.starDes.active=true;\n    this.labelNewStar.string=cc.js.formatStr(\"发现新星球:%s\",configManager.getStarConfigByIndex(gameManager.maxLevel).name);\n    this.getComponent(cc.Animation).play(\"show-new-star-tip\");\n    for (let i in this.starsForProgress){\n      let item=this.starsForProgress[i];\n      let moveLeft=cc.moveBy(0.5,cc.p(-109,0));\n      this.starsForProgress[i].runAction(cc.sequence(moveLeft,cc.callFunc(function(){\n        if (this.x<-424){   //移出左侧屏幕的精灵放到右侧备用\n          this.x=435;\n          this.getComponent(\"star\").setStarType(gameManager.maxLevel+4);  //为超出屏幕的星星设置纹理\n        }\n        if (this.x<=5){\n          this.getComponent(\"star\").unDark();\n          if (this.x>-110){\n            this.scale=1.05;\n          }else{\n            this.scale=1;\n          }\n        }else{\n          this.getComponent(\"star\").dark();\n        }\n      },item)));\n    }\n  },\n\n  onTouchStart(touch){\n    gameManager.hideStarDes();\n    this.starDes.active=false;\n  },\n\n  // called every frame\n  update: function (dt) {\n    gameManager.update(dt);\n\n    this.progressTime.progress=gameManager.leftTime/gameManager.newLineTime;\n    this.labelCurrentMax.string=\"分数：\"+(gameManager.maxLevel+1).toString();\n    this.labelTopHistory.string=\"最高：\"+(gameManager.maxHistory+1).toString();\n\n    if (gameManager.state===GameState.Pause){\n      this.gamePauseNode.active=true;\n    }\n  },\n  onRestartClicked(){\n    gameManager.restart();\n    this.initProgress();\n  },\n  onContinueClicked(){\n    this.gamePauseNode.active=false;\n    gameManager.setState(GameState.Running);\n  },\n  onPauseClicked(){\n    gameManager.setState(GameState.Pause);\n  },\n  onShareClicked(){\n    let config=configManager.getStarConfigByIndex(gameManager.maxLevel);\n    Platform.instance.shareAppMessage(`浩瀚的银河中，守护我那颗星星叫做${config.name}`,\"\",()=>{\n      cc.log(\"share success\");\n    })\n  }\n});\n"]}