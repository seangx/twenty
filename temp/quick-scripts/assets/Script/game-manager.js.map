{"version":3,"sources":["game-manager.js"],"names":["GameManager","cc","Class","properties","rowCount","columnCount","space","cubes","columnPositions","rowPositions","cubeTemplate","Node","cubePrefabs","gameNode_","halfWidth","halfHeight","maxLevel","leftTime","newLineTime","isPause","mainNode","init","prefabs","auSource","find","director","getRunningScene","getChildByName","zIndex","width","height","instantiate","au_","reset","log","restart","getComponent","Animation","play","clear","initCubes","foreachCubes","item","cell","removeFromParent","cb","i","length","row","j","column","randColorCube","max","Blue","color","Math","floor","random","tmp","push","cube","error","randLevel","x","y","createCube","parseInt","posToPoint","pos","warn","removeCube","emit","EventType","TOUCH_END","cubeCom","playDeadAction","system","ParticleSystem","resetSystem","node","position","cubeMoved","oldCell","setCellPos","getCube","levelChange","level","update","dt","addNewLine","isDead","topLine","gameOver","state","Normal","parent","playBombSound","window","gameManager"],"mappings":"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","file":"game-manager.js","sourceRoot":"../../../../assets/Script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\nimport {CubeState,CubeColors} from \"consts\";\nvar GameManager=cc.Class({\n\n  properties: {\n    rowCount: 8,\n    columnCount: 7,\n    space: 14,\n\n    cubes: [],\n    columnPositions:[],\n    rowPositions:[],\n    cubeTemplate:cc.Node,\n    cubePrefabs:[],\n    gameNode_: null,\n\n    halfWidth:0,\n    halfHeight:0,\n\n    maxLevel:2,\n    leftTime:10,\n    newLineTime:10,\n    isPause:0,\n\n    mainNode:cc.Node,\n  },\n\n  init(prefabs,mainNode,auSource) {\n    this.mainNode=mainNode;\n    this.gameNode_ = cc.find(\"/Canvas/game-node\", cc.director.getRunningScene());\n    this.gameNode_.getChildByName(\"particle\").zIndex=2;\n    this.cubePrefabs=prefabs;\n\n    this.halfWidth=this.gameNode_.width/2;\n    this.halfHeight=this.gameNode_.height/2;\n\n    this.cubeTemplate=cc.instantiate(this.cubePrefabs[0]);\n\n    this.au_=auSource;\n\n\n    this.reset();\n    cc.log(\"game manager init\");\n  },\n\n  restart(){\n    this.reset();\n    this.mainNode.getComponent(cc.Animation).play(\"game-restart\");\n  },\n\n  reset(){\n    this.clear();\n\n    this.isPause=false;\n    this.leftTime=this.newLineTime;\n    this.maxLevel=2;\n    this.initCubes();\n  },\n\n  clear(){\n    this.foreachCubes((item,cell)=>{\n      if (item){\n        item.removeFromParent();\n      }\n    });\n    // this.gameNode_.removeAllChildren(true);\n  },\n\n  foreachCubes(cb){\n    for (let i=0;i<this.cubes.length;i++){\n      let row=this.cubes[i];\n      for (let j=0;j<row.length;j++){\n        cb(row[j],{row:i,column:j});\n      }\n    }\n  },\n\n  randColorCube(){\n    let max=CubeColors.Blue+1;\n    let color=Math.floor(Math.random()*10)%max;\n    return cc.instantiate(this.cubePrefabs[color]);\n  },\n\n  initCubes() {\n    this.cubes=[];\n    //初始化数组\n    for (let i=0;i<this.rowCount;i++){\n      let tmp=[];\n      for (let j=0;j<this.columnCount;j++){\n        tmp.push(null);\n        //cube的x坐标\n        if (this.columnPositions.length<this.columnCount){\n          this.columnPositions.push(this.space+this.cubeTemplate.width/2+(this.cubeTemplate.width+this.space)*j);\n        }\n        //cube的y坐标\n        if (this.rowPositions.length<this.rowCount){\n          this.rowPositions.push(this.space+this.cubeTemplate.height/2+(this.cubeTemplate.height+this.space)*j);\n        }\n      }\n      this.cubes.push(tmp);\n    }\n\n    //初始化cube\n    for (let i = 0; i < 2; i++) {\n      for (let j = 0; j < this.columnCount; j ++) {\n        let cube=this.randColorCube();\n        if (!cube){\n          cc.error(\"init cube fail\");\n          return;\n        }\n        cube.getComponent(\"cube\").init({row:i,column:j},this.randLevel());\n        cube.x=this.space+cube.width/2+(cube.width+this.space)*j;\n        cube.y=this.space+cube.height/2+(cube.height+this.space)*i;\n\n        // cube.parent=this.gameNode_;\n\n        this.cubes[i][j]=this.createCube({row:i,column:j});\n      }\n    }\n  },\n\n  randLevel(){\n    return this.maxLevel-2+parseInt(Math.random()*10)%(this.maxLevel+1);\n  },\n\n  posToPoint(pos){\n    let cell={row:0,column:0};\n    for (let i=0;i<this.rowCount;i++){\n      if (pos.y > (i+1) * (this.cubeTemplate.height+this.space)){\n        continue;\n      }\n      cell.row=i;\n      for (let j=0;j<this.columnCount;j++){\n        if (pos.x<(j+1) * (this.cubeTemplate.width+this.space)){\n          cell.column=j;\n          return cell;\n        }\n      }\n    }\n\n    cc.warn(\"invalid touch position\");\n    return cell;\n  },\n\n  removeCube(cube){\n    this.gameNode_.emit(cc.Node.EventType.TOUCH_END);\n    cube.removeFromParent();\n    let cubeCom=cube.getComponent(\"cube\");\n    this.cubes[cubeCom.cell.row][cubeCom.cell.column]=null;\n\n  },\n\n  playDeadAction(pos){\n    let system=this.gameNode_.getChildByName(\"particle\").getComponent(cc.ParticleSystem);\n    system.resetSystem();\n    system.node.position=pos;\n    // system.active=true;\n  },\n\n  //移动数组位置到显示位置\n  cubeMoved(cube){\n    cc.log(\"cube moved\");\n    let cell=this.posToPoint(cube.position);\n    if (this.cubes[cell.row][this.column]){\n      cc.error(\"can not move cube\");\n      return;\n    }\n    let cubeCom=cube.getComponent(\"cube\");\n    let oldCell=cubeCom.cell;\n    if (this.cubes[oldCell.row][oldCell.column]===cube){  //删除旧位置信息\n      this.cubes[oldCell.row][oldCell.column]=null;\n    }\n    // else if(this.cubes[oldCell.row][oldCell.column]&&this.cubes[oldCell.row][oldCell.column]!==cube){//当前位置已存在\n    //   if (cell.row>=this.cubes.length-2){\n    //     cc.warn(\"move to top\");\n    //     return;\n    //   }\n    //   cell.row+=1;\n    // }\n    \n    this.cubes[cell.row][cell.column]=cube;\n    cubeCom.setCellPos(cell);\n  },\n\n  getCube(row,column){\n    return this.cubes[row][column];\n  },\n\n  levelChange(level){\n    if (level>this.maxLevel){\n      this.maxLevel=level;\n    }\n  },\n\n  update (dt) {\n    // this.checkFallingDownPosition();\n    if(this.isPause){\n      return;\n    }\n    this.leftTime-=dt;\n    if (this.leftTime<=0){\n      this.addNewLine();\n      this.leftTime=this.newLineTime;\n    }\n  },\n  isDead(){\n    let topLine=this.cubes[this.cubes.length-1];\n    for (let i=0;i<topLine.length;i++){\n      if (topLine[i]){\n        return true;\n      }\n    }\n    return false;\n  },\n\n  addNewLine(){\n    if(this.isDead()){\n      this.gameOver();\n      return;\n    }\n    for(let i=0;i<this.cubes.length;i++) {\n      let row=this.cubes[i];\n      for (let j=0;j<row.length;j++) {\n        let cube=row[j];\n        if (!cube){\n          continue;\n        }\n        if (cube.getComponent(\"cube\").state!==CubeState.Normal){\n          continue;\n        }\n        cube.emit(\"move-up\");\n        // this.cubes[i][j]=null;\n      }\n    }\n\n    for (let i=0;i<this.columnCount;i++){\n      this.cubes[0][i]=this.createCube({row:0,column:i});\n    }\n  },\n  gameOver(){\n    this.isPause=true;\n    this.mainNode.getComponent(cc.Animation).play(\"game-over\");\n  },\n  createCube(cell){\n    let cube=cc.instantiate(this.cubePrefabs[0]);\n    cube.getComponent(\"cube\").init(cell,this.randLevel());\n    cube.x=this.space+cube.width/2+(cube.width+this.space)*cell.column;\n    cube.y=this.space+cube.height/2+(cube.height+this.space)*cell.row;\n    cube.parent=this.gameNode_;\n    return cube;\n  },\n  playBombSound(){\n    this.au_.play();\n  }\n});\n\nwindow.gameManager=new GameManager();\n"]}