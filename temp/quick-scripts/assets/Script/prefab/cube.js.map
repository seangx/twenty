{"version":3,"sources":["cube.js"],"names":["cc","Class","extends","Component","properties","state","default","Normal","type","cell","p","star","levelUpAnimation","Prefab","onLoad","node","on","Node","EventType","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_CANCEL","onTouchEnd","TOUCH_END","onLevelUp","onMoveUp","game","isTouched","row","moveTo","pAdd","position","height","gameManager","space","runAction","touchStartPos","Touched","TouchMove","levelUp","levelChange","starType","playLevelUpAnimation","playBombSound","init","setStarType","start","setCellPos","setState","log","js","formatStr","JSON","stringify","Bombing","error","disablePhysics","cubeMoved","FallingDown","activePhysics","FallingBottom","update","dt","removeCube","fitCell","checkFallingDown","resetY","y","touch","getLocation","parent","emit","resetX","dis","pDistance","pSub","newCell","posToPoint","column","checkBombing","cube1","cube2","onBeginContact","contact","selfCollider","otherCollider","body","RigidBodyType","Static","AddNewLine","cubeSelf","getComponent","cubeOther","rowPositions","x","columnPositions","toString","RigidBody","awake","Dynamic","Running","downCube","getCube","Block","sequence","callFunc","ani","instantiate","addChild"],"mappings":"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","file":"cube.js","sourceRoot":"../../../../../assets/Script/prefab","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n// import {CubeState} from './color-cube';\nimport {CubeState,StarTypes,GameState} from \"../consts\";\nimport Star from \"./star.js\";\n\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    state:{\n      default:CubeState.Normal,\n      type:CubeState\n    },\n    cell:cc.p(0,0),\n    star:{\n      default:null,\n      type:Star\n    },\n    levelUpAnimation:cc.Prefab\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n    this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this);\n    this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this);\n    // this.gameNode = cc.find(\"/Canvas/game-node\", cc.director.getRunningScene());\n    this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this);\n    this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this);\n\n    this.node.on(\"level-up\",this.onLevelUp,this);\n\n    this.node.on(\"move-up\",this.onMoveUp,this);\n\n    cc.game.on(\"add-new-line\",()=>{\n      if (!this.isTouched()||this.cell.row>0){\n        return;\n      }\n      let moveTo=cc.moveTo(0.2,cc.pAdd(this.node.position,cc.p(0,this.node.height+gameManager.space)));\n      this.node.runAction(moveTo);\n    });\n\n    this.touchStartPos=cc.p(0,0);\n  },\n\n  isTouched(){\n    return this.state===CubeState.Touched||this.state===CubeState.TouchMove;\n  },\n\n  // destroy(){\n  //   this.gameNode.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this);\n  // },\n\n  onLevelUp(){\n    this.star.levelUp();\n    gameManager.levelChange(this.star.starType);\n    // gameManager.playDeadAction(this.node.position);\n    this.playLevelUpAnimation();\n    gameManager.playBombSound();\n  },\n\n  init(cell,starType) {\n    this.cell=cell;\n    this.star.setStarType(starType);\n    // this.setState(CubeState.Block);\n  },\n\n  start() {\n\n  },\n\n  setCellPos(cell){\n    this.cell=cell;\n  },\n\n  setState(state) {\n    cc.log(cc.js.formatStr(\"set state,old:%d,new:%d,pos:%s\",this.state,state,JSON.stringify(this.cell)));\n    if (this.state===CubeState.Bombing){\n      cc.error(\"cube is marking dead\");\n      return;\n    }\n    if (this.state===state){\n      return;\n    }\n    switch (state){\n      case CubeState.Normal:{\n        this.disablePhysics();\n        gameManager.cubeMoved(this.node);\n        break;\n      }\n      case CubeState.TouchMove:{\n        break;\n      }\n      case CubeState.Touched:\n      case CubeState.FallingDown:{\n        this.activePhysics();\n        // this.resetX();\n      }\n      case CubeState.FallingBottom:{\n        break;\n      }\n    }\n    this.state=state;\n  },\n\n  update(dt) {\n    switch (this.state){\n      case CubeState.Bombing:{\n        gameManager.removeCube(this.node);\n        return;\n      }\n      case CubeState.TouchMove:{\n        this.fitCell();\n        break;\n      }\n      case CubeState.Normal:{\n        // this.disablePhysics();\n        this.checkFallingDown();\n        break;\n      }\n      case CubeState.FallingBottom:{\n        this.resetY();\n        this.setState(CubeState.Normal);\n        break;\n      }\n    }\n    //非touch状态时进行触底检查\n    if (this.state!==CubeState.Touched&&this.state!==CubeState.TouchMove){\n      if (this.node.y<this.node.height/2+gameManager.space){\n        this.setState(CubeState.FallingBottom);\n      }\n    }\n  },\n\n  onTouchStart(touch){\n    cc.log(\"on touch start\");\n    this.setState(CubeState.Touched);\n    // let body=this.node.getComponent(cc.RigidBody);\n    // body.awake=true;\n    // body.type=cc.RigidBodyType.Dynamic;\n\n    this.activePhysics();\n    this.touchStartPos=touch.getLocation();\n  },\n\n  onTouchEnd(touch){\n    cc.log(\"on touch end\");\n    this.node.parent.emit(cc.Node.EventType.TOUCH_END);   //告知touch关节触摸结束\n    if (this.state!==CubeState.Touched&&this.state!==CubeState.TouchMove){\n      return;\n    }\n    //重置mouse关节的冲量\n    this.disablePhysics();\n    this.setState(CubeState.FallingDown);\n    this.resetX();\n\n    this.touchStartPos=cc.p(0,0);\n  },\n\n  onTouchMove(touch){\n    cc.log(\"on touch moved\");\n    let dis=cc.pDistance(cc.pSub(touch.getLocation(),this.touchStartPos),cc.p(0,0));\n    if (dis>3){\n      if (this.state===CubeState.Touched){\n        this.setState(CubeState.TouchMove);\n        // gameManager.cubeMove(this.cell);\n\n      }\n    }\n  },\n\n  fitCell(){\n    let newCell=gameManager.posToPoint(this.node.position);\n    if (newCell.row!==this.cell.row||newCell.column!==this.cell.column){\n      gameManager.cubeMoved(this.node);\n\n    }\n  },\n\n  checkBombing(cube1,cube2){\n    if (cube1.star.starType!== cube2.star.starType) {\n      return false;\n    }\n\n    if (cube1.state === CubeState.Bombing) {\n      return false;\n    }\n\n    if (cube1.state===CubeState.TouchMove||cube1.state===CubeState.FallingDown){\n      return true;\n    }\n    return false;\n  },\n\n  //仅动态类型才处理碰撞\n  onBeginContact: function (contact, selfCollider, otherCollider) {\n    if (selfCollider.body.type===cc.RigidBodyType.Static||gameManager.state===GameState.AddNewLine){\n      return;\n    }\n\n    let cubeSelf=selfCollider.node.getComponent(\"cube\");\n    let cubeOther=otherCollider.getComponent(\"cube\");\n    if (!cubeSelf||!cubeOther){\n      return;\n    }\n\n    if (this.checkBombing(cubeSelf,cubeOther)){\n      cubeSelf.setState(CubeState.Bombing);\n      cubeOther.node.emit(\"level-up\");\n    }\n\n    if (cubeSelf.state===CubeState.FallingDown){\n      cubeSelf.setState(CubeState.FallingBottom);\n    }\n  },\n\n  resetY(){\n    //更新cube的y坐标\n    cc.log(\"reset y called\");\n    let cell=gameManager.posToPoint(this.node.position);\n    this.node.y=gameManager.rowPositions[cell.row];\n  },\n  resetX(){\n    //更新cube的x坐标\n    cc.log(\"reset x called\");\n    let cell=gameManager.posToPoint(this.node.position);\n    this.node.x=gameManager.columnPositions[cell.column];\n    cc.log(\"reset x,new x:\"+this.node.x.toString());\n  },\n\n  activePhysics(){\n    let body=this.node.getComponent(cc.RigidBody);\n    body.awake=true;\n    body.type=cc.RigidBodyType.Dynamic;\n  },\n\n  disablePhysics(){\n    let body=this.node.getComponent(cc.RigidBody);\n    if (body.type!==cc.RigidBodyType.Static){\n      body.type=cc.RigidBodyType.Static;\n    }\n  },\n\n  checkFallingDown(){\n    if (this.cell.row<=0||gameManager.state!==GameState.Running){\n      return;\n    }\n    let downCube=gameManager.getCube(this.cell.row-1,this.cell.column);\n    if (!downCube){\n      this.setState(CubeState.FallingDown);\n    }\n  },\n\n  onMoveUp(){\n    if (this.state===CubeState.Touched||this.state===CubeState.TouchMove){\n      return;\n    }\n    this.setState(CubeState.Block);\n    let moveTo=cc.moveTo(0.2,cc.pAdd(this.node.position,cc.p(0,this.node.height+gameManager.space)));\n    this.node.runAction(cc.sequence(moveTo,cc.callFunc(()=>{\n      gameManager.cubeMoved(this.node);\n      this.setState(CubeState.Normal);\n    })));\n  },\n\n  playLevelUpAnimation(){\n    if (!this.levelUpAnimation){\n      return;\n    }\n    let ani=cc.instantiate(this.levelUpAnimation);\n    this.node.addChild(ani);\n  },\n});\n"]}